from pymavlink import mavutil
import time

PORT="/dev/ttyAMA0"; BAUD=115200
NAME="AAA_OPTIONS"

m = mavutil.mavlink_connection(PORT, baud=BAUD)
m.wait_heartbeat(timeout=10)
SYS = m.target_system
print("FC sysid:", SYS)

# 1) collect component IDs we can see
comps=set()
t0=time.time()
while time.time()-t0 < 3:
    hb = m.recv_match(type="HEARTBEAT", blocking=False)
    if hb:
        comps.add(hb.get_srcComponent())
    time.sleep(0.01)
print("Seen components:", sorted(comps))

# 2) ask each component for AAA_OPTIONS, stop when one replies
def read_from(comp):
    m.mav.param_request_read_send(SYS, comp, NAME.encode(), -1)
    t0=time.time()
    while time.time()-t0 < 1.5:
        msg = m.recv_match(type="PARAM_VALUE", blocking=False)
        if msg and msg.param_id.decode(errors="ignore").strip("\x00") == NAME:
            return msg.param_value
        time.sleep(0.02)
    return None

for comp in sorted(comps):
    val = read_from(comp)
    print(f"comp {comp}: {val}")
